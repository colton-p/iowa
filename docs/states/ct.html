<html>

<head>
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>

<body>
    <p id="score-box"></p>
    <div style="display: flex">
        <div>
            <?xml version="1.0" encoding="utf-8" ?>
<svg baseProfile="full" fill="#d0d0d0" height="291.1560126004101" stroke="#ffffff" stroke-width="1" version="1.1" width="400.0" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink">
	<defs />
	<g id="counties"><path d="M 44.844270693894444,104.80930649841964 L 47.87110571613001,61.82437860259297 L 52.023317337572,0.0 L 104.32479570833111,1.6540750973686185 L 125.5168771401796,2.532180647874775 L 140.58792131012538,3.1411178966917044 L 149.69943992080064,3.5029995348831298 L 145.39405792343567,23.290259042909486 L 174.5181294343909,21.576171727626058 L 170.63314252778065,35.65347021886657 L 161.74926909298142,67.20238547923675 L 147.8271160637495,69.42366128378346 L 151.44681164822885,92.37974016161226 L 151.5273916767184,92.90029870701461 L 154.6130287355598,112.87283950968393 L 139.22023850291455,121.82282429598973 L 139.2054549969428,126.77753952106592 L 121.27524733225452,135.14600055311902 L 119.02093421249886,146.7858751405332 L 109.0356888333399,148.5852078304041 L 99.1470265313453,147.5427096930704 L 85.08359560418081,149.68810229652033 L 87.08915389409114,159.33139155901267 L 60.15838855563693,152.98043249863312 L 47.099894890548626,105.08076011614433 L 44.844270693894444,104.80930649841964 z" id="c09005" />
		<path d="M 85.08359560418081,149.68810229652033 L 99.1470265313453,147.5427096930704 L 109.0356888333399,148.5852078304041 L 119.02093421249886,146.7858751405332 L 121.27524733225452,135.14600055311902 L 139.2054549969428,126.77753952106592 L 139.22023850291455,121.82282429598973 L 154.6130287355598,112.87283950968393 L 163.8085848049029,111.6046180493477 L 162.14183299887384,135.56653740531073 L 183.1331757947368,138.90770912258492 L 202.0809574385397,129.56122695656654 L 202.76024983515347,139.04042398928885 L 203.61193213194014,151.7963399423122 L 203.32481690870242,172.1704564334843 L 217.21501082283524,169.28909397258636 L 222.37953910247003,168.0989025252042 L 230.6182301334203,197.85330921876553 L 247.04949183508958,218.52294427257573 L 244.43333266762,219.4398536632146 L 233.92592156674118,214.47788644941954 L 222.39781624769535,215.26145095279443 L 222.29128144779875,215.33569415390494 L 214.83916965177008,220.52589514709175 L 200.39201687902758,222.02569461040747 L 195.06185512624907,215.57243701598313 L 175.36136584294422,221.63219631594635 L 170.7164404581056,219.81799934062138 L 164.16805941467646,217.2576781773553 L 156.95278891898823,221.9569067561757 L 153.9845180966394,223.8885439039721 L 153.69332000137908,224.07799535158492 L 146.60000588279968,231.47813505680796 L 134.3856038263354,234.82636566182944 L 129.8585408199983,243.1026636830811 L 125.49477318929631,238.68365729408194 L 132.93990654353172,218.23151788582047 L 132.94272615338724,212.20710865743368 L 136.89250079905244,205.54042981807922 L 127.0366459660464,196.95767562640276 L 120.51758892664826,187.2075512904384 L 113.18316162642247,180.59598050483683 L 108.1894807630227,172.67451396583525 L 89.67195388647282,164.97250377643354 L 87.08915389409114,159.33139155901267 L 85.08359560418081,149.68810229652033 z" id="c09009" />
		<path d="M 149.69943992080064,3.5029995348831298 L 151.58035670858104,3.5771160251820104 L 182.69590009568358,4.121290760021162 L 190.25592352772804,14.693835338468691 L 197.47157087069,13.653058070718332 L 199.11001179912972,13.416302876038568 L 205.49072944312152,4.2677608986195 L 231.53803125833005,5.778983058514096 L 247.83028385160426,4.786094747785876 L 251.69995896605107,4.834482894538015 L 255.12936440837916,28.537806033491837 L 250.9190019312068,29.123877395144937 L 250.1568411467303,49.804209653831656 L 254.36470988606195,52.33413526201127 L 261.206830996586,83.8189988056185 L 272.5457011490938,115.22274825505264 L 272.33974511430114,122.93740536148866 L 260.7713525099481,128.09516305712373 L 252.76532123461294,110.83964928363223 L 244.79860236531468,112.03879310449088 L 209.94740339959392,116.19286094869634 L 209.81832811790562,122.59961793644325 L 202.0809574385397,129.56122695656654 L 183.1331757947368,138.90770912258492 L 162.14183299887384,135.56653740531073 L 163.8085848049029,111.6046180493477 L 154.6130287355598,112.87283950968393 L 151.5273916767184,92.90029870701461 L 151.44681164822885,92.37974016161226 L 147.8271160637495,69.42366128378346 L 161.74926909298142,67.20238547923675 L 170.63314252778065,35.65347021886657 L 174.5181294343909,21.576171727626058 L 145.39405792343567,23.290259042909486 L 149.69943992080064,3.5029995348831298 z" id="c09003" />
		<path d="M 260.7713525099481,128.09516305712373 L 272.33974511430114,122.93740536148866 L 277.74467252008134,126.72980415950298 L 289.96565047972604,118.48075795208372 L 287.9360948881323,111.63663662894575 L 307.26781992992784,92.20066071262296 L 324.20218816911637,107.58314006615538 L 326.4078698066741,104.95472195467279 L 343.82543683147367,108.91330490441078 L 365.85921033530036,113.50036387736526 L 385.7733085921141,110.72396986211251 L 399.8464602099749,111.726028363377 L 400.0,123.52992835145908 L 399.99962669519863,123.54577276708969 L 398.83350648088754,172.83764528967356 L 398.83219585681496,172.89281952648048 L 390.1952395250454,174.24290981000658 L 391.1260763686207,190.16700642409168 L 386.1533101951949,199.44416031561784 L 380.7854257297168,195.07263559525225 L 366.26336032271945,197.00257452152857 L 352.84606210335426,200.68974318244716 L 337.8750066131315,201.54187010398482 L 329.69144144654376,205.6456484909175 L 315.78589886618335,201.275976205654 L 308.7689411964418,205.5045327214899 L 296.92193319769757,211.14897512018425 L 287.2225853194857,211.79863590291802 L 279.67113763617306,184.88548757081443 L 267.72070373575986,171.86002410283675 L 294.1224765052475,168.3790934202489 L 290.4260778071056,145.9870025713314 L 268.2255444243582,144.31710702952154 L 260.7713525099481,128.09516305712373 z" id="c09011" />
		<path d="M 250.9190019312068,29.123877395144937 L 255.12936440837916,28.537806033491837 L 251.69995896605107,4.834482894538015 L 274.50869674297115,5.102443367844725 L 290.911465984415,5.276913098575404 L 315.0698658107406,5.633201143065766 L 327.9589209612559,5.809750428012043 L 334.8150285959408,5.899824722206199 L 335.5571206726278,24.97907117359249 L 324.8401437378223,24.959578585998237 L 311.48865560321843,25.359479730819373 L 311.54505152275476,59.03922732815513 L 322.4455042852253,59.04294275235833 L 324.2733979517038,81.32924522951387 L 304.5610336303932,88.37939132184796 L 307.26781992992784,92.20066071262296 L 287.9360948881323,111.63663662894575 L 289.96565047972604,118.48075795208372 L 277.74467252008134,126.72980415950298 L 272.33974511430114,122.93740536148866 L 272.5457011490938,115.22274825505264 L 261.206830996586,83.8189988056185 L 254.36470988606195,52.33413526201127 L 250.1568411467303,49.804209653831656 L 250.9190019312068,29.123877395144937 z" id="c09013" />
		<path d="M 304.5610336303932,88.37939132184796 L 324.2733979517038,81.32924522951387 L 322.4455042852253,59.04294275235833 L 311.54505152275476,59.03922732815513 L 311.48865560321843,25.359479730819373 L 324.8401437378223,24.959578585998237 L 335.5571206726278,24.97907117359249 L 334.8150285959408,5.899824722206199 L 358.26707499524935,6.187782875145617 L 379.2323180396328,6.488942098412707 L 396.39480199842745,6.7169233918751 L 396.72903482993866,10.959706131855524 L 398.6615293449459,66.00689523493833 L 399.5398087508474,88.40090108769877 L 399.5447976685097,88.52798957567994 L 399.8464602099749,111.726028363377 L 385.7733085921141,110.72396986211251 L 365.85921033530036,113.50036387736526 L 343.82543683147367,108.91330490441078 L 326.4078698066741,104.95472195467279 L 324.20218816911637,107.58314006615538 L 307.26781992992784,92.20066071262296 L 304.5610336303932,88.37939132184796 z" id="c09015" />
		<path d="M 6.638321854000521,255.4510104883482 L 51.02002360869297,229.18090098911424 L 37.11708973951613,206.4208864966831 L 38.70181743767054,187.02029735339454 L 38.92682978326717,184.26258346753727 L 40.36988826686969,166.55851384331777 L 42.08491480189663,143.004260181162 L 44.35114933467734,111.79484888489496 L 44.844270693894444,104.80930649841964 L 47.099894890548626,105.08076011614433 L 60.15838855563693,152.98043249863312 L 87.08915389409114,159.33139155901267 L 89.67195388647282,164.97250377643354 L 108.1894807630227,172.67451396583525 L 113.18316162642247,180.59598050483683 L 120.51758892664826,187.2075512904384 L 127.0366459660464,196.95767562640276 L 136.89250079905244,205.54042981807922 L 132.94272615338724,212.20710865743368 L 132.93990654353172,218.23151788582047 L 125.49477318929631,238.68365729408194 L 129.8585408199983,243.1026636830811 L 128.36175276718373,245.8371360689004 L 123.82061875352309,247.71294233099016 L 115.01544012258918,245.8523102227573 L 108.85021149718443,244.5467196525138 L 96.42882959201795,255.59513709244337 L 94.88274726255071,255.81020585130887 L 89.20412310108213,256.5989428209709 L 82.27105206144067,257.55937789143377 L 73.63633192078528,259.13573450968556 L 77.3427888202728,264.1954735800564 L 70.4513731569343,271.646963345958 L 63.18715652607841,274.5178999780196 L 53.64467551418302,273.4046402318498 L 43.526662110034174,276.77055932078 L 34.127103523453194,282.69307155874264 L 27.12935741246362,282.84557187706594 L 14.257519019771058,291.1560126004101 L 14.250649942637288,291.0590306463259 L 13.891496868215107,285.98659897812456 L 13.895866559225531,282.201263934364 L 0.0,259.3642105861118 L 6.638321854000521,255.4510104883482 z" id="c09001" />
		<path d="M 202.0809574385397,129.56122695656654 L 209.81832811790562,122.59961793644325 L 209.94740339959392,116.19286094869634 L 244.79860236531468,112.03879310449088 L 252.76532123461294,110.83964928363223 L 260.7713525099481,128.09516305712373 L 268.2255444243582,144.31710702952154 L 290.4260778071056,145.9870025713314 L 294.1224765052475,168.3790934202489 L 267.72070373575986,171.86002410283675 L 279.67113763617306,184.88548757081443 L 287.2225853194857,211.79863590291802 L 285.44034832461847,211.91743171532556 L 277.61140043600886,216.23709122356186 L 273.605229378705,211.70778607080797 L 259.8529087617465,214.0287238914523 L 247.04949183508958,218.52294427257573 L 230.6182301334203,197.85330921876553 L 222.37953910247003,168.0989025252042 L 217.21501082283524,169.28909397258636 L 203.32481690870242,172.1704564334843 L 203.61193213194014,151.7963399423122 L 202.76024983515347,139.04042398928885 L 202.0809574385397,129.56122695656654 z" id="c09007" />
	</g>
</svg>
            <table>
                <thead>
                    <th></th>
                    <th>size</th>
                    <th>diff</th>
                </thead>
                <tbody id="group-pops">

                </tbody>
            </table>
            <div id="valid-box"></div>
            <div id="best-score-box" style="font-style: italic"></div>
        </div>
        <div id='hover-text' style="width: 200px"></div>
        <ul id="sorted-list"> </ul>
    </div>

    <hr>

    <footer id="footer">
        <a href="?k=2">k = 2</a>
        <a href="?k=3">k = 3</a>
        <a href="?k=4">k = 4</a>
        <br>
        
        <a href="de.html">de</a>
        
        <a href="ri.html">ri</a>
        
        <a href="ct.html">ct</a>
        
        <a href="nh.html">nh</a>
        
        <a href="ma.html">ma</a>
        
        <a href="vt.html">vt</a>
        
        <a href="az.html">az</a>
        
        <a href="me.html">me</a>
        
        <a href="nv.html">nv</a>
        
        <a href="nj.html">nj</a>
        
        <a href="wy.html">wy</a>
        
        <a href="md.html">md</a>
        
        <a href="ut.html">ut</a>
        
        <a href="nm.html">nm</a>
        
        <a href="or.html">or</a>
        
        <a href="wa.html">wa</a>
        
        <a href="id.html">id</a>
        
        <a href="sc.html">sc</a>
        
        <a href="nd.html">nd</a>
        
        <a href="wv.html">wv</a>
        
        <a href="mt.html">mt</a>
        
        <a href="ca.html">ca</a>
        
        <a href="ny.html">ny</a>
        
        <a href="co.html">co</a>
        
        <a href="la.html">la</a>
        
        <a href="sd.html">sd</a>
        
        <a href="al.html">al</a>
        
        <a href="fl.html">fl</a>
        
        <a href="pa.html">pa</a>
        
        <a href="wi.html">wi</a>
        
        <a href="ar.html">ar</a>
        
        <a href="ok.html">ok</a>
        
        <a href="ms.html">ms</a>
        
        <a href="mi.html">mi</a>
        
        <a href="mn.html">mn</a>
        
        <a href="oh.html">oh</a>
        
        <a href="in.html">in</a>
        
        <a href="ne.html">ne</a>
        
        <a href="tn.html">tn</a>
        
        <a href="ia.html">ia</a>
        
        <a href="nc.html">nc</a>
        
        <a href="il.html">il</a>
        
        <a href="ks.html">ks</a>
        
        <a href="mo.html">mo</a>
        
        <a href="ky.html">ky</a>
        
        <a href="va.html">va</a>
        
        <a href="ga.html">ga</a>
        
        <a href="tx.html">tx</a>
        
        <br>
        <a href="../index.html">index</a>
    </footer>

</body>

<script> const STATE = 'ct'</script>
<script>const COUNTY_DATA = {"c09001":{"name":"Fairfield","pop":957419,"adj":["c09005","c09009","c36027","c36059","c36079","c36103","c36119"]},"c09003":{"name":"Hartford","pop":899498,"adj":["c09005","c09007","c09009","c09011","c09013","c25013"]},"c09005":{"name":"Litchfield","pop":185186,"adj":["c09001","c09003","c09009","c25003","c25013","c36027"]},"c09007":{"name":"Middlesex","pop":164245,"adj":["c09003","c09009","c09011","c36103"]},"c09009":{"name":"New Haven","pop":864835,"adj":["c09001","c09003","c09005","c09007","c36103"]},"c09011":{"name":"New London","pop":268555,"adj":["c09003","c09007","c09013","c09015","c36103","c44003","c44009"]},"c09013":{"name":"Tolland","pop":149788,"adj":["c09003","c09011","c09015","c25013","c25027"]},"c09015":{"name":"Windham","pop":116418,"adj":["c09011","c09013","c25027","c44003","c44007"]}}; </script>
<script>const COLORS = ['darkgreen', 'blue', 'darkorange', 'purple', 'red', 'brown'];
const N_GROUPS = Number.parseInt(new URLSearchParams(document.location.search).get('k')) || 4;

const FMT = {
    human: (v) => new Intl.NumberFormat('en', { notation: 'compact' }).format(v),
    long: (v) => new Intl.NumberFormat('fr-FR').format(v),
}


function isValid() {
    const group_ixs = Array(N_GROUPS).fill(0).map((v, ix) => ix);

    const bad_groups = group_ixs.filter(ix => !isGroupConnected(ix));
    
    return [bad_groups.length === 0, bad_groups];
}

function isGroupConnected(grp) {
    const seen = {};
    function dfs(u) {
        seen[u] = true;
        const adj = COUNTY_DATA[u].adj.filter(v => GROUPS[v] === grp && !seen[v] && COUNTY_DATA[v]);
        adj.forEach(dfs);
    }
    const inGroup = Object.keys(GROUPS).filter(k => GROUPS[k] === grp);
    if (inGroup.length === 0) { return false; }
    dfs(inGroup[0]);

    return inGroup.sort().join(';') === Object.keys(seen).sort().join(';')
}


const makeToggle = (cid) => () => {
    toggleGroup(cid);
    updateDisplay([cid]);
}

function toggleGroup(cid) {
    const old_grp = GROUPS[cid];
    const new_grp = (old_grp+1) % N_GROUPS;
    GROUPS[cid] = new_grp;
}

const onMouseOver = function() {
    const el = document.getElementById('hover-text');
    const {name, pop} = COUNTY_DATA[this.id];

    el.textContent = `${name}\n${FMT.long(pop)}`;
}

function updateDisplay(cids) {
    cids.forEach(cid => {
        const grp = GROUPS[cid];
        const color = COLORS[grp]

        document.getElementById('list-'+cid).style.color = color;
        document.getElementById(cid).style.fill = color;
    });

    const rslt = sumGroups();
    Object.entries(rslt).forEach(([group, pop]) => {
        const row = [FMT.human(pop), FMT.long(pop), FMT.long(Math.floor(pop - TOTAL / N_GROUPS))];
        //textContent = FMT.human(pop) + "\t" + FMT.long(pop) + "\t" + Math.floor(pop - TOTAL / N_GROUPS);
        document.getElementById(`pop-${group}`).innerHTML =  row.map(v => `<td>${v}</td>`).join('')
    });

    const lsKey = `${STATE}-${N_GROUPS}`;
    const score = Math.floor(TOTAL/N_GROUPS - Math.min(...Object.values(rslt)));
    let bestScore = localStorage.getItem(lsKey) || '';
    const [valid, badGroups] = isValid();
    document.getElementById('score-box').innerHTML = `score: <b>${FMT.long(score)}</b>`;
    if (valid) {
        document.getElementById('valid-box').textContent = '✅ valid';
    } else {
        document.getElementById('valid-box').textContent = `❌ group ${badGroups[0]} not connected`
    }
    if (valid && Number(bestScore || TOTAL) > score) {
        bestScore = score;
        localStorage.setItem(lsKey, score);
        localStorage.setItem(lsKey+'-groups', JSON.stringify(friendlyGroups()));
    }

    document.getElementById('best-score-box').textContent = 'best: ' + FMT.long(bestScore);
}

function sumGroups() {
    const rslt = Object.fromEntries(Array(N_GROUPS).fill(0).map((v, ix) => [ix, 0]));
    Object.entries(GROUPS).forEach(([id, group]) => {
        const pop = COUNTY_DATA[id].pop;
        rslt[group] += pop;
    });

    return rslt;
}

function friendlyGroups() {
    const rslt = Object.fromEntries(Array(N_GROUPS).fill(0).map((v, ix) => [ix, []]));
    Object.entries(GROUPS).forEach(([id, grp]) => {
        rslt[grp].push(COUNTY_DATA[id].name);
    });
    return rslt;
}

function setup() {
    const county_els = Array.from(document.getElementsByTagName('path'));
    const county_ids = county_els.map(e => e.id);

    // map handlers
    county_els.forEach(path_el => {
        path_el.onmouseover = onMouseOver.bind(path_el);
        path_el.onclick = makeToggle(path_el.id);
    });

    // sorted list
    const sorted_counties = county_ids.map(cid => ({...COUNTY_DATA[cid], id: cid}));

    sorted_counties.sort((a,b) => b.pop - a.pop);
    //sorted_counties.sort((a,b) => b.name > a.name ? -1 : 1);

    const list_el = document.getElementById('sorted-list');
    sorted_counties.forEach(({id, name, pop}) => {
        const li = document.createElement("li");
        li.id = 'list-'+id;
        li.onclick = makeToggle(id);
        li.appendChild(document.createTextNode(name + ": " + FMT.long(pop)));
        list_el.appendChild(li) 

        li.onmouseover = () => {
            document.getElementById(id).style.stroke= 'red';
        }
        li.onmouseleave = () => {
            document.getElementById(id).style.stroke= null;
        }
    });

    const groups_el = document.getElementById('group-pops');
    for (let ix = 0; ix < N_GROUPS; ++ix) {
        const el = document.createElement("tr");
        el.id = 'pop-'+ix;
        el.style.color = COLORS[ix];
        groups_el.appendChild(el);
    }

    const total_pop = sorted_counties.reduce((acc, r) => acc + r.pop, 0);
    const groups = Object.fromEntries(county_ids.map(id => [id, 0]));

    return [groups, total_pop];
};

const [GROUPS, TOTAL] = setup();
updateDisplay(Object.keys(GROUPS)); </script>

</html>