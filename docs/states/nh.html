<html>

<head>
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
    <style>
    @media (prefers-color-scheme: dark) {
        :root,
        ::backdrop {
            color-scheme: light;
            --bg: #fff;
            --accent-bg: #f5f7ff;
            --text: #212121;
            --text-light: #585858;
            --border: #898EA4;
            --accent: #0d47a1;
            --accent-hover: #1266e2;
            --accent-text: var(--bg);
            --code: #d81b60;
            --preformatted: #444;
            --marked: #ffdd33;
            --disabled: #efefef;
        }
    }
    </style>
</head>

<body>
    <p id="score-box"></p>
    <div style="display: flex">
        <div>
            <?xml version="1.0" encoding="utf-8" ?>
<svg baseProfile="full" fill="#d0d0d0" height="400.0" stroke="#ffffff" stroke-width="1" version="1.1" width="208.4906423081755" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink">
	<defs />
	<g id="counties"><path d="M 148.50058744866956,309.84627998040867 L 157.01794127873114,299.048926650315 L 156.4771551150025,270.8726558819872 L 170.39787761359813,272.1778715632575 L 171.97984873802682,279.3571509375736 L 178.6527960402,270.51831961559094 L 179.70046392347268,275.1724604660798 L 179.07372130846647,280.65240401513125 L 178.28624679106503,287.5274032345818 L 176.56821656045153,295.689775078368 L 183.38999138037403,303.50449362058447 L 189.21738728138462,311.8229912071669 L 195.96058169366714,319.86564510334233 L 194.7115396259984,325.62498811008123 L 194.70893563107575,325.6369870200452 L 194.4165280442821,333.3961916718841 L 195.3855234772313,334.2839541372774 L 189.1728636439182,340.9067021290217 L 166.9853491131248,340.87466968899093 L 172.11243369533966,332.2347050596529 L 160.68493836940414,322.792541710167 L 160.04615583361252,322.2561647321639 L 147.23996329056075,311.349011177726 L 148.50058744866956,309.84627998040867 z" id="c33017" />
		<path d="M 13.520391802662983,320.258730350924 L 14.324522318388254,317.56062662179687 L 15.71480769447955,312.8921226865732 L 17.92569312457429,304.18386565967614 L 17.459849725067542,301.5632663657329 L 16.770092357671256,297.6800686950621 L 18.699038617165698,287.55213057907133 L 18.702813062983964,287.53229230912814 L 20.574419550628516,277.6853060298541 L 20.84264271323504,265.3205625847302 L 25.99044826823252,260.5310708554108 L 51.25349910613188,268.68670626506696 L 52.96434242489322,272.47075154852905 L 70.31620430800764,272.53948520639375 L 61.775788680469674,286.6114954969149 L 57.04406116406722,285.94294344618277 L 52.88698612210525,304.0934638198862 L 61.8750082339001,324.7768194172792 L 58.901154093977986,325.9289332670129 L 58.57396738530095,333.8175086202197 L 42.82102621604052,333.2656179081209 L 45.31718895810094,325.6009880727032 L 21.09423010884022,333.0692014772588 L 14.410108237703785,332.47145821213593 L 12.340526354897076,328.53149018855316 L 13.520391802662983,320.258730350924 z" id="c33019" />
		<path d="M 57.04406116406722,285.94294344618277 L 61.775788680469674,286.6114954969149 L 70.31620430800764,272.53948520639375 L 75.15299097187761,265.5429219589831 L 78.22769571466189,261.9569829455251 L 83.45182231497925,270.18460359536556 L 93.48853307972938,267.29235699300045 L 107.58893771140514,286.9537344896799 L 113.3698436661067,284.3033080321687 L 122.09128915267817,290.58541011064995 L 135.80689152287133,300.4635400554986 L 148.50058744866956,309.84627998040867 L 147.23996329056075,311.349011177726 L 145.6080868991634,315.08097603965217 L 143.5326886775229,320.04688433803955 L 139.4307263108301,328.679648397646 L 135.1555967775123,337.9475038692552 L 129.92375934432937,347.31332810291957 L 131.12840859216598,352.1750486185897 L 117.57679131144258,346.03189171400123 L 117.04322110770359,343.07565436576175 L 103.12959411161575,345.34948328761493 L 100.15347805504936,330.27324437973266 L 92.88139856323677,332.22425234683993 L 84.15420295972356,334.59136153442023 L 79.00646681434068,335.98143030545185 L 72.63467217617588,321.8691745083455 L 61.8750082339001,324.7768194172792 L 52.88698612210525,304.0934638198862 L 57.04406116406722,285.94294344618277 z" id="c33013" />
		<path d="M 112.03658867980683,219.51763768242415 L 134.04203155542726,213.19431885120918 L 131.7665160558424,185.31212171029 L 127.92737545734303,167.8030736887549 L 134.50543993017797,174.88357960641764 L 136.82794256756168,187.15149742599277 L 145.97881705714997,162.8093516328022 L 169.09331968410473,163.69825182548266 L 172.56306121713055,156.40813665585335 L 172.7641516341974,160.40236480861964 L 173.78181894975896,185.8274265748437 L 175.36442895009895,224.70678407238904 L 175.71901057650635,231.79641541109746 L 176.42542237465068,245.8962236760005 L 177.21600178315887,259.1648312424625 L 177.61935757701053,265.92294003707013 L 178.6527960402,270.51831961559094 L 171.97984873802682,279.3571509375736 L 170.39787761359813,272.1778715632575 L 156.4771551150025,270.8726558819872 L 151.30830970655288,269.13083425709993 L 136.24656637436277,257.2026842889646 L 136.17672307550427,257.1376551708086 L 125.49955402161409,247.00416893628528 L 115.27676234621066,236.99817711066936 L 113.91926571885628,231.62534064132666 L 112.03658867980683,219.51763768242415 z" id="c33003" />
		<path d="M 58.57396738530095,333.8175086202197 L 58.901154093977986,325.9289332670129 L 61.8750082339001,324.7768194172792 L 72.63467217617588,321.8691745083455 L 79.00646681434068,335.98143030545185 L 84.15420295972356,334.59136153442023 L 92.88139856323677,332.22425234683993 L 100.15347805504936,330.27324437973266 L 103.12959411161575,345.34948328761493 L 117.04322110770359,343.07565436576175 L 117.57679131144258,346.03189171400123 L 131.12840859216598,352.1750486185897 L 132.87115514450215,361.69705739492053 L 124.54918777864894,364.2118828760307 L 125.56279387869309,370.416704329505 L 127.30820427908914,380.45984993245753 L 134.81226673764542,384.4017622891171 L 134.42906672094418,386.56647928188096 L 147.87263915317877,393.91024973677787 L 146.77393183203165,393.93992698314173 L 146.71802778663428,393.94143362197633 L 142.3837289009034,400.0 L 135.86365028362002,399.8481195119869 L 103.7196024538545,398.88173778328206 L 91.33104260997082,398.51049513198745 L 88.30881876017732,398.39519575351034 L 84.5979600451981,398.2523123121412 L 74.0446583626318,397.83805893519576 L 70.62484562822772,397.70130898792155 L 65.50518147825812,385.8661119728815 L 62.59242109909236,365.9240259429563 L 55.73859152369191,362.0084360981196 L 58.57396738530095,333.8175086202197 z" id="c33011" />
		<path d="M 0.0,373.6217725531917 L 2.828208553264672,368.7924669435286 L 2.8372930633798448,360.05614470242574 L 7.3133717273160315,358.1540075984356 L 12.725546512560577,352.56976065752013 L 11.963665538779065,350.09804501419404 L 10.840523803455788,346.4517173979859 L 13.941740621712455,339.9801372407343 L 12.171658922832163,329.71443650018574 L 12.340526354897076,328.53149018855316 L 14.410108237703785,332.47145821213593 L 21.09423010884022,333.0692014772588 L 45.31718895810094,325.6009880727032 L 42.82102621604052,333.2656179081209 L 58.57396738530095,333.8175086202197 L 55.73859152369191,362.0084360981196 L 62.59242109909236,365.9240259429563 L 65.50518147825812,385.8661119728815 L 70.62484562822772,397.70130898792155 L 53.410912938545145,396.99430009454494 L 50.05593774425592,396.8528776113794 L 48.53411728986222,396.78833803731317 L 39.598443696454765,396.40120213581963 L 30.625752300127434,396.00401151642365 L 16.053515511058457,395.3408978475776 L 11.629503349662752,395.1351595611574 L 10.802218969295076,395.09645812282355 L 8.695098194465428,389.8049674022978 L 1.7640799501085207,383.0548073401009 L 0.23588210861383807,374.88430752636486 L 0.0,373.6217725531917 z" id="c33005" />
		<path d="M 89.66891084571279,138.49682430644123 L 97.61268990641912,135.79441180905064 L 102.48571911318214,128.49174329931336 L 109.7892467552045,123.44174632077396 L 108.89350883912948,116.37937343517137 L 113.61741272513538,111.55532979047672 L 112.86187605095871,104.1483963198758 L 109.25931728955504,98.36472656969147 L 104.62123839912623,85.81588643851948 L 110.78453388259848,76.91041545433642 L 116.00407319463378,65.32178902444802 L 119.04505123194832,60.558953089432514 L 114.9756095698678,50.725583917818696 L 118.28494667917423,44.992232245186806 L 118.55946583814747,36.36688474539793 L 123.94532138929208,30.31729581557209 L 127.13240595365824,20.880483382484744 L 128.57441974888755,16.636250682142453 L 124.98910582639186,10.381302995848179 L 133.4079220262326,5.6260917607496115 L 141.71903707662474,0.662160696871673 L 145.98631759963538,5.829359818596515 L 152.71455596939035,9.942315401913973 L 157.38757507771982,9.623380429687113 L 160.6043435806465,3.5811613225579157 L 163.33072886567686,0.0 L 166.5035469265135,46.8053172277694 L 169.11834470031224,87.19503065951497 L 170.9029174084399,123.43241597400255 L 171.36268947892438,132.5810502787687 L 172.130824750835,147.83381717491744 L 172.43229719184666,153.8093453780578 L 172.56306121713055,156.40813665585335 L 169.09331968410473,163.69825182548266 L 145.97881705714997,162.8093516328022 L 136.82794256756168,187.15149742599277 L 134.50543993017797,174.88357960641764 L 127.92737545734303,167.8030736887549 L 124.88639333875192,162.13918618024655 L 110.2871525292689,161.33560400959715 L 109.04730567397861,153.64675458813247 L 96.95227572868396,149.4561600574785 L 89.66891084571279,138.49682430644123 z" id="c33007" />
		<path d="M 102.00497097559277,258.44895216912 L 102.31540720222341,248.7317870203132 L 109.76101581015145,247.58698980605405 L 116.42599959158528,246.6514141242749 L 115.27676234621066,236.99817711066936 L 125.49955402161409,247.00416893628528 L 136.17672307550427,257.1376551708086 L 136.24656637436277,257.2026842889646 L 151.30830970655288,269.13083425709993 L 156.4771551150025,270.8726558819872 L 157.01794127873114,299.048926650315 L 148.50058744866956,309.84627998040867 L 135.80689152287133,300.4635400554986 L 122.09128915267817,290.58541011064995 L 113.3698436661067,284.3033080321687 L 107.58893771140514,286.9537344896799 L 93.48853307972938,267.29235699300045 L 102.00497097559277,258.44895216912 z" id="c33001" />
		<path d="M 26.447720455337052,260.1052505967865 L 31.556216383649325,242.98060589308048 L 38.57141900381478,236.97951970402622 L 39.75871382023376,234.96567391938297 L 42.921291553092864,229.59642232344623 L 44.48667309818231,219.60374460153176 L 51.63506208459987,208.00229153719516 L 50.47112750088316,201.4679310787583 L 54.56882029347902,195.65692707335333 L 54.59644085915567,195.61772668065814 L 55.06540900577815,194.952081324482 L 59.38177604493243,184.47062811317434 L 57.55097980397179,175.77026147769257 L 56.74055826779472,171.9132928311496 L 57.59591850898534,162.41630661296026 L 58.47505342257575,155.5129065910252 L 63.33928704089748,150.4921690565258 L 69.6354812620917,148.5422363475324 L 77.26015917807064,148.6222516584407 L 81.45247527799657,147.0384378239791 L 83.53888041441597,146.2492807441759 L 87.97336186958171,139.07251795337743 L 89.66891084571279,138.49682430644123 L 96.95227572868396,149.4561600574785 L 109.04730567397861,153.64675458813247 L 110.2871525292689,161.33560400959715 L 124.88639333875192,162.13918618024655 L 127.92737545734303,167.8030736887549 L 131.7665160558424,185.31212171029 L 134.04203155542726,213.19431885120918 L 112.03658867980683,219.51763768242415 L 113.91926571885628,231.62534064132666 L 115.27676234621066,236.99817711066936 L 116.42599959158528,246.6514141242749 L 109.76101581015145,247.58698980605405 L 102.31540720222341,248.7317870203132 L 102.00497097559277,258.44895216912 L 93.48853307972938,267.29235699300045 L 83.45182231497925,270.18460359536556 L 78.22769571466189,261.9569829455251 L 75.15299097187761,265.5429219589831 L 70.31620430800764,272.53948520639375 L 52.96434242489322,272.47075154852905 L 51.25349910613188,268.68670626506696 L 25.99044826823252,260.5310708554108 L 26.447720455337052,260.1052505967865 z" id="c33009" />
		<path d="M 124.54918777864894,364.2118828760307 L 132.87115514450215,361.69705739492053 L 131.12840859216598,352.1750486185897 L 129.92375934432937,347.31332810291957 L 135.1555967775123,337.9475038692552 L 139.4307263108301,328.679648397646 L 143.5326886775229,320.04688433803955 L 145.6080868991634,315.08097603965217 L 147.23996329056075,311.349011177726 L 160.04615583361252,322.2561647321639 L 160.68493836940414,322.792541710167 L 172.11243369533966,332.2347050596529 L 166.9853491131248,340.87466968899093 L 189.1728636439182,340.9067021290217 L 195.3855234772313,334.2839541372774 L 202.5477938449341,340.8375733368979 L 208.4906423081755,343.86203170053597 L 205.0134769936581,351.20155579683285 L 201.72847584169992,356.8863477141982 L 198.04874173063692,364.7519682170449 L 196.6622148105471,370.2348842239969 L 196.02737201476836,372.7429944087229 L 190.68079800883186,373.1068827268146 L 183.21559172264355,370.97841317831416 L 179.2116687617335,373.4036790432903 L 171.9289358432429,374.9788492578043 L 169.98549343113336,379.2887402830701 L 168.26588315552814,383.098559094629 L 162.37239544397883,382.278398921614 L 158.6082818630392,381.75258573503265 L 154.52268014468459,385.57782089353725 L 155.05493365121248,393.7131258960685 L 147.87263915317877,393.91024973677787 L 134.42906672094418,386.56647928188096 L 134.81226673764542,384.4017622891171 L 127.30820427908914,380.45984993245753 L 125.56279387869309,370.416704329505 L 124.54918777864894,364.2118828760307 z" id="c33015" />
	</g>
</svg>
            <table>
                <thead>
                    <th></th>
                    <th>size</th>
                    <th>diff</th>
                </thead>
                <tbody id="group-pops">

                </tbody>
            </table>
            <div id="valid-box"></div>
            <div id="best-score-box" style="font-style: italic"></div>
        </div>
        <div id='hover-text' style="width: 200px"></div>
        <ul id="sorted-list"> </ul>
    </div>

    <hr>

    <footer id="footer">
        <a href="?k=2">k = 2</a>
        <a href="?k=3">k = 3</a>
        <a href="?k=4">k = 4</a>
        <br>
        
        <a href="de.html">de</a>
        
        <a href="ri.html">ri</a>
        
        <a href="ct.html">ct</a>
        
        <a href="nh.html">nh</a>
        
        <a href="ma.html">ma</a>
        
        <a href="vt.html">vt</a>
        
        <a href="az.html">az</a>
        
        <a href="me.html">me</a>
        
        <a href="nv.html">nv</a>
        
        <a href="nj.html">nj</a>
        
        <a href="wy.html">wy</a>
        
        <a href="md.html">md</a>
        
        <a href="ut.html">ut</a>
        
        <a href="nm.html">nm</a>
        
        <a href="or.html">or</a>
        
        <a href="wa.html">wa</a>
        
        <a href="id.html">id</a>
        
        <a href="sc.html">sc</a>
        
        <a href="nd.html">nd</a>
        
        <a href="wv.html">wv</a>
        
        <a href="mt.html">mt</a>
        
        <a href="ca.html">ca</a>
        
        <a href="ny.html">ny</a>
        
        <a href="co.html">co</a>
        
        <a href="la.html">la</a>
        
        <a href="sd.html">sd</a>
        
        <a href="al.html">al</a>
        
        <a href="fl.html">fl</a>
        
        <a href="pa.html">pa</a>
        
        <a href="wi.html">wi</a>
        
        <a href="ar.html">ar</a>
        
        <a href="ok.html">ok</a>
        
        <a href="ms.html">ms</a>
        
        <a href="mi.html">mi</a>
        
        <a href="mn.html">mn</a>
        
        <a href="oh.html">oh</a>
        
        <a href="in.html">in</a>
        
        <a href="ne.html">ne</a>
        
        <a href="tn.html">tn</a>
        
        <a href="ia.html">ia</a>
        
        <a href="nc.html">nc</a>
        
        <a href="il.html">il</a>
        
        <a href="ks.html">ks</a>
        
        <a href="mo.html">mo</a>
        
        <a href="ky.html">ky</a>
        
        <a href="va.html">va</a>
        
        <a href="ga.html">ga</a>
        
        <a href="tx.html">tx</a>
        
        <br>
        <a href="../index.html">index</a>
    </footer>

</body>

<script> const STATE = 'nh'</script>
<script>const COUNTY_DATA = {"c33001":{"name":"Belknap","pop":63705,"adj":["c33003","c33009","c33013","c33017"]},"c33003":{"name":"Carroll","pop":50107,"adj":["c23017","c23031","c33001","c33007","c33009","c33017"]},"c33005":{"name":"Cheshire","pop":76458,"adj":["c25011","c25027","c33011","c33019","c50025"]},"c33007":{"name":"Coos","pop":31268,"adj":["c23017","c33003","c33009","c50009"]},"c33009":{"name":"Grafton","pop":91118,"adj":["c33001","c33003","c33007","c33013","c33019","c50005","c50009","c50017","c50027"]},"c33011":{"name":"Hillsborough","pop":422937,"adj":["c25009","c25017","c25027","c33005","c33013","c33015","c33019"]},"c33013":{"name":"Merrimack","pop":153808,"adj":["c33001","c33009","c33011","c33015","c33017","c33019"]},"c33015":{"name":"Rockingham","pop":314176,"adj":["c23031","c25009","c33011","c33013","c33017"]},"c33017":{"name":"Strafford","pop":130889,"adj":["c23031","c33001","c33003","c33013","c33015"]},"c33019":{"name":"Sullivan","pop":43063,"adj":["c33005","c33009","c33011","c33013","c50025","c50027"]}}; </script>
<script>const COLORS = ['darkgreen', 'blue', 'darkorange', 'purple', 'red', 'brown'];
const N_GROUPS = Number.parseInt(new URLSearchParams(document.location.search).get('k')) || 4;

const FMT = {
    human: (v) => new Intl.NumberFormat('en', { notation: 'compact' }).format(v),
    long: (v) => new Intl.NumberFormat('fr-FR').format(v),
}


function isValid() {
    const group_ixs = Array(N_GROUPS).fill(0).map((v, ix) => ix);

    const bad_groups = group_ixs.filter(ix => !isGroupConnected(ix));
    
    return [bad_groups.length === 0, bad_groups];
}

function isGroupConnected(grp) {
    const seen = {};
    function dfs(u) {
        seen[u] = true;
        const adj = COUNTY_DATA[u].adj.filter(v => GROUPS[v] === grp && !seen[v] && COUNTY_DATA[v]);
        adj.forEach(dfs);
    }
    const inGroup = Object.keys(GROUPS).filter(k => GROUPS[k] === grp);
    if (inGroup.length === 0) { return false; }
    dfs(inGroup[0]);

    return inGroup.sort().join(';') === Object.keys(seen).sort().join(';')
}


const makeToggle = (cid) => () => {
    toggleGroup(cid);
    updateDisplay([cid]);
}

function toggleGroup(cid) {
    const old_grp = GROUPS[cid];
    const new_grp = (old_grp+1) % N_GROUPS;
    GROUPS[cid] = new_grp;
}

const onMouseOver = function() {
    const el = document.getElementById('hover-text');
    const {name, pop} = COUNTY_DATA[this.id];

    el.textContent = `${name}\n${FMT.long(pop)}`;
}

function updateDisplay(cids) {
    cids.forEach(cid => {
        const grp = GROUPS[cid];
        const color = COLORS[grp]

        document.getElementById('list-'+cid).style.color = color;
        document.getElementById(cid).style.fill = color;
    });

    const rslt = sumGroups();
    Object.entries(rslt).forEach(([group, pop]) => {
        const row = [FMT.human(pop), FMT.long(pop), FMT.long(Math.floor(pop - TOTAL / N_GROUPS))];
        //textContent = FMT.human(pop) + "\t" + FMT.long(pop) + "\t" + Math.floor(pop - TOTAL / N_GROUPS);
        document.getElementById(`pop-${group}`).innerHTML =  row.map(v => `<td>${v}</td>`).join('')
    });

    const lsKey = `${STATE}-${N_GROUPS}`;
    const score = Math.floor(TOTAL/N_GROUPS - Math.min(...Object.values(rslt)));
    let bestScore = localStorage.getItem(lsKey) || '';
    const [valid, badGroups] = isValid();
    document.getElementById('score-box').innerHTML = `score: <b>${FMT.long(score)}</b>`;
    if (valid) {
        document.getElementById('valid-box').textContent = '✅ valid';
    } else {
        document.getElementById('valid-box').textContent = `❌ group ${badGroups[0]} not connected`
    }
    if (valid && Number(bestScore || TOTAL) > score) {
        bestScore = score;
        localStorage.setItem(lsKey, score);
        localStorage.setItem(lsKey+'-groups', JSON.stringify(friendlyGroups()));
    }

    document.getElementById('best-score-box').textContent = 'best: ' + FMT.long(bestScore);
}

function sumGroups() {
    const rslt = Object.fromEntries(Array(N_GROUPS).fill(0).map((v, ix) => [ix, 0]));
    Object.entries(GROUPS).forEach(([id, group]) => {
        const pop = COUNTY_DATA[id].pop;
        rslt[group] += pop;
    });

    return rslt;
}

function friendlyGroups() {
    const rslt = Object.fromEntries(Array(N_GROUPS).fill(0).map((v, ix) => [ix, []]));
    Object.entries(GROUPS).forEach(([id, grp]) => {
        rslt[grp].push(COUNTY_DATA[id].name);
    });
    return rslt;
}

function setup() {
    const county_els = Array.from(document.getElementsByTagName('path'));
    const county_ids = county_els.map(e => e.id);

    // map handlers
    county_els.forEach(path_el => {
        path_el.onmouseover = onMouseOver.bind(path_el);
        path_el.onclick = makeToggle(path_el.id);
    });

    // sorted list
    const sorted_counties = county_ids.map(cid => ({...COUNTY_DATA[cid], id: cid}));

    sorted_counties.sort((a,b) => b.pop - a.pop);
    //sorted_counties.sort((a,b) => b.name > a.name ? -1 : 1);

    const list_el = document.getElementById('sorted-list');
    sorted_counties.forEach(({id, name, pop}) => {
        const li = document.createElement("li");
        li.id = 'list-'+id;
        li.onclick = makeToggle(id);
        li.appendChild(document.createTextNode(name + ": " + FMT.long(pop)));
        list_el.appendChild(li) 

        li.onmouseover = () => {
            document.getElementById(id).style.stroke= 'red';
        }
        li.onmouseleave = () => {
            document.getElementById(id).style.stroke= null;
        }
    });

    const groups_el = document.getElementById('group-pops');
    for (let ix = 0; ix < N_GROUPS; ++ix) {
        const el = document.createElement("tr");
        el.id = 'pop-'+ix;
        el.style.color = COLORS[ix];
        groups_el.appendChild(el);
    }

    const total_pop = sorted_counties.reduce((acc, r) => acc + r.pop, 0);
    const groups = Object.fromEntries(county_ids.map(id => [id, 0]));

    return [groups, total_pop];
};

const [GROUPS, TOTAL] = setup();
updateDisplay(Object.keys(GROUPS)); </script>

</html>